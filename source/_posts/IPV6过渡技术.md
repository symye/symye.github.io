---
# HCIE-IPV6
layout: pags
title: IPV6过渡技术
date: 2025-07-26 22:29:54
tags: Network
categories: 
- [HCIE,3.2IPV6过渡技术] 
---

### IPV6过渡技术

- 背景：当前世界上不同地区对部署IPv6的需求强烈程度不一，且当前IPv4网络仍然占主流地位，因此短时间内IPv6和IPv4将会共存，可以借助双栈技术、隧道技术、转换技术，实现IPv4/IPv6共存业务的互通

#### IPV4/IPV6双栈

- 现在大部分企业都是用的这种方式，比较简单，网络规划设计工作量相对更少
- 缺点：必须设备同时支持IPV4/IPV6
- 配置

![命令](../imgs/IPv6过渡技术/双栈.png)

<!-- more -->
#### 隧道技术

手动隧道

手动隧道即边界设备不能自动获得隧道目的IPv4地址，需要手工配置，报文才能正确发送至隧道终点

1. IPv6 over IPv4手动隧道


- 隧道的边界设备必须支持IPv6/IPv4双协议栈。其它设备只需实现单协议栈即可
- 手动隧道要求在设备上手工配置隧道的源地址和目的地址，如果一个边界设备要与多个设备建立手动隧道，就需要在设备上配置多个隧道，配置比较麻烦。所以手动隧道通常用于两个边界路由器之间，为两个IPv6网络提供连接

隧道转发机制
- 当隧道边界设备的IPv6侧收到一个IPv6报文后， 根据IPv6报文的目的地址查找IPv6路由转发表，如果该报文是从此虚拟隧道接口（Tunnel接口）转发出去，则根据隧道接口配置的隧道源和目的IPv4地址进行封装。封装后的报文变成一个IPv4报文，交给IPv4协议栈处理。报文通过IPv4网络转发到隧道的终点。隧道终点收到一个隧道协议报文后，进行隧道解封装。并将解封装后的报文交给IPv6协议栈处理

实验配置（本章配置都在图中，就不另外贴出来了）

![命令](../imgs/IPv6过渡技术/ipv6-ipv4拓扑配置图.png)


![命令](../imgs/IPv6过渡技术/验证IPV6-IPV4-ISIS.png)


2. IPv6 over IPv4 GRE隧道

- IPv6 over IPv4 GRE隧道使用标准的GRE隧道技术提供了点到点连接服务，需要手工指定隧道的端点地址
- 转发机制同IPv6 over IPv4手动隧道


![命令](../imgs/IPv6过渡技术/IPV6-IPV4GRE.png)


![命令](../imgs/IPv6过渡技术/验证IPV6GRE.png)



自动隧道

自动隧道中，用户仅需要配置设备隧道的源IPv4地址，隧道的目的IPv4地址由设备自动生成。为了使设备能够自动产生目的IPv4地址，隧道接口的IPv6地址采用内嵌IPv4地址的特殊IPv6地址形式。设备从IPv6报文中的目的IPv6地址中解析出IPv4地址，然后以这个IPv4地址代表的节点作为隧道的终点

1. IPv4兼容IPv6自动隧道

- IPv4兼容IPv6自动隧道数据转发流程
    - IPv6报文到达R1后，以目的地址::155.1.23.3查找IPv6路由，发现路由的下一跳为虚拟的Tunnel口
    - R1对IPv6报文进行了封装。封装的时候，IPv6报文被封装为IPv4报文，IPv4报文中的源地址为隧道的源IPv4地址155.1.12.1，而目的IPv4地址直接从IPv4兼容IPv6地址::155.1.23.3的后32位拷贝过来即155.1.23.3
    - 这个报文被路由器从隧道口发出后，在IPv4的网络中被路由转发到目的地，也就是R3。R3收到报文后，进行解封装，把其中的IPv6报文取出，送给IPv6协议栈进行处理
    - R3返回R1的报文也是按照这个过程来进行的

![命令](../imgs/IPv6过渡技术/IPV4兼容IPV6自动隧道配置.png)


![命令](../imgs/IPv6过渡技术/验证自动隧道ipv6toipv4.png)


2. 6to4隧道

![命令](../imgs/IPv6过渡技术/6to4自动隧道拓扑配置.png)


- 6to4地址格式

![命令](../imgs/IPv6过渡技术/6to4地址格式.png)

- 6to4地址的网络前缀长度为64 bit
  - 前48 bit（2002: a.b.c.d）被分配给路由器上的IPv4地址决定了，用户不能改变
  - 后16位（SLA）是由用户自己定义的
- 6to4地址解释
  - FP（Format Prefix）：可聚合全球单播地址的格式前缀，其值为001
  - TLA（Top Level Aggregator）：顶级聚合标识符，其值为0x0002
  - SLA（Site Level Aggregator）：站点级聚合标识符


3. ISATAP隧道

![命令](../imgs/IPv6过渡技术/isatap自动隧道拓扑配置.png)

- ISATAP隧道同样使用了内嵌IPv4地址的特殊IPv6地址形式，用IPv4地址做为接口标识
- ISATAP接口标识格式

![命令](../imgs/IPv6过渡技术/ISATAP接口标识格式.png)

- ISATAP地址前64位：通过向ISATAP路由器发送请求来得到的，它可以进行地址自动配置。在ISATAP隧道的两端设备之间可以运行NDP
- ISATAP接口标识解释
  -  如果IPv4地址是全局唯一的，则u位为1，否则u位为0。典型的ISATAP隧道应用是在站点内部，因此其内嵌的IPv4地址不需要是全局唯一的
  -  g位是IEEE群体/个体标志，固定为0

4. 6PE

优势
- 建网成本低：运营商能够很好的利用现有的MPLS网络资源，无须对网络进行升级改造就可以为用户提供IPv6服务。6PE设备还可以同时为用户提供IPv6 VPN和IPv4 VPN等多种业务

实验配置

![命令](../imgs/IPv6过渡技术/6pe实验配置.png)


验证底层环境


![命令](../imgs/IPv6过渡技术/6pe验证底层环境.png)


![命令](../imgs/IPv6过渡技术/6pe验证BGP.png)


![命令](../imgs/IPv6过渡技术/验证报文6pe.png)


5. 6VPE

![命令](../imgs/IPv6过渡技术/6vpe拓扑配置.png)


#### IPV6转换技术

NET64
- NET64是一种将IPV6网络地址转换成IPV4网络地址的NET技术

原理描述
- 如果设备接收到的IPv6报文的前缀是设备为NAT64定义的前缀，说明报文的目的地址是IPv4网络，报文将经过NAT64处理后被转发至IPv4网络
- 如果设备接收到的IPv6报文的前缀不是设备为NAT64定义的前缀，说明报文的目的地址是IPv6网络，报文将不经过NAT64处理，直接被转发至IPv6网络

NAT64前缀

NAT64前缀分为两种形式
- 知名前缀：即64:FF9B::/96，缺省情况下已存在，无需配置
-  自定义前缀：前缀长度为32、40、48、56、64或96

![命令](../imgs/IPv6过渡技术/NAT64前缀.png)

实验配置

![命令](../imgs/IPv6过渡技术/NAT64.png)



![命令](../imgs/IPv6过渡技术/验证NET64.png)

----------------------------------------------------------------------------------------------------------------------------